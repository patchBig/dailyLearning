# HTTP 协议和它的“补丁”们

[前端高手进阶](https://kaiwu.lagou.com/course/courseInfo.htm?courseId=180#/detail/h5?id=3186)

## http/0.9

定义了客户端发起请求、服务端响应请求的通信模式。

## http/1.0

核心改变是增加头部设定，头部内容以键值对的形式设置。请求头部通过 Accept 字段来告诉服务端可以接收的文件类型，响应头部再通过 Content-type 字段来告诉浏览器返回文件的类型。

## http/1.1

增加了创建持久连接的方法，主要实现是一个连接传输完成后，并不是马上关闭，而是继续复用它传输其他请求的数据，这个连接保持到浏览器或者服务器要求断开连接为止。

## 三次握手

1. 客户端处于 CLOSED 的状态，服务端处于 LISTEN 状态，客户端给服务端发送一个 SYN 报文，并指明客户端的初始化序列号 ISN，此时客户端处于 SYN_SEND 状态
2. 当服务端接受到客户端的 SYN 报文之后，会以自己的 SYN 报文作为应答，并且制定自己的初始化序列号 ISN，同时会把客户端的 ISN + 1 作为 ACK 的值，表示自己已接收到 SYN 序列，此时服务端处于 SYN_SEND 的状态
3. 当客户端收到 SYN 报文之后，会发送一个 ACK 报文，当然同样把服务器的 ISN + 1 作为 ACK 的值，表示已经收到服务端的 SYN 报文，此时客户端处于 ESTABLISHED 状态。服务器收到 ACK 报文之后，也处于 ESTABLISHED 状态，此时双方成功建立起了连接。

## 四次挥手

1. 挥手之前都处于 ESTABLISHED 状态。客户端发送 FIN 报文，用来关闭客户端到服务器的数据传输
2. 服务端收到 FIN 后发送 ACK 报文，并把客户端的序列号值加 1 作为 ACK 报文的序列号，表示已经收到客户端的报文了，此时服务端处于 CLOSE_WAIT 状态
3. 如果服务端同意关闭连接，则会向客户端发送一个 FIN 报文，并且指定一个序列号，此时服务端处于 LAST_ACK 状态
4. 客户端收到 ACK 之后，处于 FIN_WAIT_2 状态。等待收到的 FIN 报文再发送 ACK 作为应答，并且把服务端的序列号值 +1 作为自己 ACK 报文的序列号值，此时客户端处于 TIME_WAIT 状态。等待一段时间后会进入 CLOSED 状态，当服务端收到 ACK 报文后，也会变成 CLOSED 状态，此时连接关闭。

## HTTP/1.1 并发能力受限

1. 浏览器为了减少服务器压力，限制了同一个域下的 HTTP 连接数，即 6~8 个，对应的优化方式使用多个域名来加载资源
2. 队头阻塞，多个请求共用一个 TCP 连接，但在一个连接中同一时刻只能处理一个请求，在当前请求没有结束之前，其他的请求只能处于阻塞状态。

## HTTP/2

默认不再使用 ASCII 编码传输，而是改为二进制数据。

利用一个连接发送多个请求的方式称为"多路复用"，客户端将请求的内容封装成不同的带有编号的二进制帧，然后将这些帧同时发送给服务端。服务端接收到数据之后，将相同编号的帧合并为完整的请求信息。同时，服务端返回结果，客户端接收结果也遵循这个帧的拆分和组合的过程。

## HTTPS 原理

[彻底搞懂HTTPS的加密机制](https://zhuanlan.zhihu.com/p/43789231)

## UDP

HTTP/3 将底层依赖的 TCP 改成了 UDP，解决在丢包或网络中断的情况下后面的所有数据都被阻塞。UDP 最大的特点是传输数据时不需要建立连接，可以同时发送多个数据包，所以传输效率很高，缺点是没有确认机制来保证对方一定收到数据。



